<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   ShareCode - Modern Code Sharing
  </title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
      font-family: 'Inter', sans-serif;
    }
    /* Custom scrollbar for textarea */
    textarea::-webkit-scrollbar {
      width: 8px;
    }
    textarea::-webkit-scrollbar-thumb {
      background-color: #3b82f6;
      border-radius: 4px;
    }
  </style>
 </head>
 <body class="bg-gray-50 dark:bg-gray-900 min-h-screen flex flex-col p-6 transition-colors duration-500">
  <header class="flex justify-end items-center space-x-4 mb-6">
   <button id="themeToggle" aria-label="Toggle theme" class="flex items-center gap-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-lg shadow hover:bg-gray-300 dark:hover:bg-gray-600 transition focus:outline-none focus:ring-2 focus:ring-blue-500">
    <i class="fas fa-moon" id="themeIcon"></i>
    <span id="themeText">Dark Mode</span>
   </button>
   <img alt="ShareCode logo, stylized SC letters in blue square" class="rounded-lg shadow-md w-16 h-16 object-cover" height="64" src="https://storage.googleapis.com/a1aa/image/d3e994ab-de55-4811-c1ff-d930a2673a5b.jpg" width="64"/>
  </header>
  <main class="w-full max-w-3xl bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-10 sm:p-12 md:p-16 transition-colors duration-500 mx-auto flex-grow">
   <header class="mb-10 text-center">
    <h1 class="text-4xl font-extrabold text-gray-900 dark:text-gray-100 tracking-tight">
     Share Your Code
    </h1>
    <p class="mt-2 text-gray-600 dark:text-gray-300 max-w-md mx-auto">
     Quickly create sharable links for your code snippets with syntax highlighting support.
    </p>
   </header>
   <form autocomplete="off" class="space-y-8" id="pasteForm" novalidate="" spellcheck="false">
    <div>
     <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2" for="name">
      Feature Name
     </label>
     <input aria-describedby="name-desc" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-3 text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition" id="name" maxlength="100" name="name" placeholder="Enter feature name" required="" type="text"/>
     <p class="mt-1 text-xs text-gray-400 dark:text-gray-500" id="name-desc">
      Give your code snippet a descriptive name.
     </p>
    </div>
    <div>
     <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2" for="code">
      Code Snippet
     </label>
     <textarea aria-describedby="code-desc" class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-3 font-mono text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition resize-y" id="code" name="code" placeholder="Paste your code here..." required="" rows="12"></textarea>
     <p class="mt-1 text-xs text-gray-400 dark:text-gray-500" id="code-desc">
      Make sure your code is properly formatted before submitting.
     </p>
    </div>
    <button class="w-full flex justify-center items-center gap-3 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white font-semibold rounded-lg px-6 py-3 transition focus:outline-none focus:ring-4 focus:ring-blue-300" type="submit">
     <i class="fas fa-link fa-lg">
     </i>
     Create Link
    </button>
   </form>
   <section class="mt-10 text-center font-medium break-words" id="result"></section>
  </main>
  <footer class="mt-12 text-center text-gray-500 dark:text-gray-400 text-sm select-none">
   Â© 2024 ShareCode. All rights reserved.
  </footer>
  <script>
   // Theme toggle logic
   const themeToggle = document.getElementById('themeToggle');
   const themeIcon = document.getElementById('themeIcon');
   const themeText = document.getElementById('themeText');
   const result = document.getElementById('result');
   const form = document.getElementById('pasteForm');

   // Initialize theme from localStorage or system preference
   function setTheme(theme) {
     if (theme === 'dark') {
       document.documentElement.classList.add('dark');
       themeIcon.classList.remove('fa-sun');
       themeIcon.classList.add('fa-moon');
       themeText.textContent = 'Dark Mode';
       themeToggle.setAttribute('aria-label', 'Switch to light mode');
     } else {
       document.documentElement.classList.remove('dark');
       themeIcon.classList.remove('fa-moon');
       themeIcon.classList.add('fa-sun');
       themeText.textContent = 'Light Mode';
       themeToggle.setAttribute('aria-label', 'Switch to dark mode');
     }
   }

   function getPreferredTheme() {
     if (localStorage.getItem('theme')) {
       return localStorage.getItem('theme');
     }
     if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
       return 'dark';
     }
     return 'light';
   }

   let currentTheme = getPreferredTheme();
   setTheme(currentTheme);

   themeToggle.addEventListener('click', () => {
     currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
     localStorage.setItem('theme', currentTheme);
     setTheme(currentTheme);
   });

   form.addEventListener('submit', async (e) => {
     e.preventDefault();
     result.textContent = '';
     const formData = new FormData(form);
     const data = Object.fromEntries(formData);

     // Removed language validation since language select is removed

     try {
       const response = await fetch('/api/create', {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify(data),
       });

       if (!response.ok) {
         throw new Error(`Server error: ${response.statusText}`);
       }

       const json = await response.json();

       result.innerHTML = `
         <p class="mb-2 ${currentTheme === 'dark' ? 'text-gray-300' : 'text-gray-700'}">Your code link is ready:</p>
         <a href="/view/${json.id}" target="_blank" rel="noopener noreferrer" class="inline-block text-blue-600 dark:text-blue-400 underline break-all hover:text-blue-800 dark:hover:text-blue-300 transition">
           ${location.origin}/view/${json.id}
         </a>
       `;
       result.classList.remove('text-red-600', 'dark:text-red-500');
       result.classList.add('text-blue-700', 'dark:text-blue-500');
       form.reset();
     } catch (error) {
       result.textContent = `Failed to create link: ${error.message}`;
       result.classList.remove('text-blue-700', 'dark:text-blue-500');
       result.classList.add('text-red-600', 'dark:text-red-500');
     }
   });
  </script>
 </body>
</html>
